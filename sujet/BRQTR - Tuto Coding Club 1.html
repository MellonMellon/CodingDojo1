<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="created" content="2020-01-21T09:31:01+0100"/>
        <meta name="modified" content="2020-01-24T23:25:59+0100"/>
        <meta name="tags" content=""/>
        <meta name="last device" content="ThÃ©oâ€™s MacBook Pro (2)"/>
    </head>
    <body>
        <div class="note-wrapper">
            <p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/briqueterie-logotype-horizontal-2C-noir.png'></p>
<h1>Coding Dojo #1</h1>
<p>Bienvenue Ã  ce tout premier atelier de la sÃ©rie des Coding Dojo ! ğŸ˜ƒ</p>
<p>Au cours de la journÃ©e vous allez dÃ©couvrir votre Raspberry Pi, coder avec le langage Python et utiliser la librairie OpenCV afin de crÃ©er votre propre systÃ¨me de vidÃ©o surveillance avec reconnaissance faciale.</p>
<br>
<h1>Votre Bundle</h1>
<p>CommenÃ§ons par dÃ©couvrir votre matÃ©riel, le bundle est composÃ© des Ã©lÃ©ments suivants :</p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Bundle.jpeg'></p>
<br>
<ol start="1"><li>Raspberry Pi 4 2Go
</li><li>Cable dâ€™alimentation USB C
</li><li>Carte mÃ©moire microSD 16Go
</li><li>Module camÃ©ra 5MP 160 degrÃ©s
</li></ol>
<br>
<br>
<hr>
<br>
<br>
<h1>I - Un peu dâ€™Ã©lectronique</h1>
<h2>I.1 - Le matÃ©riel</h2>
<p>DÃ©couvrons plus en dÃ©tail votre nouveau Raspberry Pi !</p>
<br>
<p>LancÃ© en 2012, le tout premier Raspberry Pi est un nano ordinateur faisant la taille dâ€™une carte de crÃ©dit et trÃ¨s abordable. Il a pour but de permettre Ã  quiconque de sâ€™initier Ã  la programmation, les Raspberry sont aujourdâ€™hui utilisÃ©s par de nombreux makers du monde entier.</p>
<p>Vous possÃ©dez dÃ©sormais la derniÃ¨re rÃ©vision en date et le plus puissant des modÃ¨les, il sâ€™agit du Raspberry Pi 4 model B avec 2Go de RAM.</p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Rasp%20Pi.jpeg'></p>
<br>
<p>Description des composants principaux :</p>
<ol start="1"><li>Processeur Broadcom Ã  1,5Ghz quadricoeur (architecture ARM Cortex A72)
</li><li>Port dâ€™alimentation USB C (ce port est dÃ©diÃ© exclusivement Ã  lâ€™alimentation, inutile dâ€™essayer dâ€™accÃ©der aux donnÃ©es de la carte microSD ğŸ˜‰ )
</li><li>2 ports mini-hdmi en guise de sorties vidÃ©o (oui, vous pourrez brancher deux Ã©crans sur votre Raspberry ğŸ˜)
</li><li>Connecteur camÃ©ra
</li><li>Sortie audio jack 3.5
</li><li>2 ports USB 2.0
</li><li>2 ports USB 3.0
</li><li>Prise Ethernet gigabit
</li><li>Puce Wifi gÃ©rant la norme AC, les frÃ©quences 2.4Ghz / 5Ghz et le Bluetooth 5.0 (oui, le 9 nâ€™est pas sur la photo, â€œitâ€™s a trapâ€ comme dirait lâ€™amiral Ackbar ğŸ‘½)
</li></ol>
<br>
<br>
<h2>I.2 - Assemblage</h2>
<p>Place Ã  la pratique, vous trÃ©pignez dâ€™impatience, il est temps de mettre en service notre Raspberry Pi.</p>
<br>
<ul><li>Commencez par retourner votre Raspberry et insÃ©rez dÃ©licatement la carte MicroSD.
</li></ul>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Carte%20SD.jpeg'></p>
<br>
<ul><li>Occupons-nous de la camÃ©ra, repÃ©rez le connecteur sur le Raspberry avec lâ€™inscription â€œCAMERAâ€ sur la carte mÃ¨re et ouvrez-le en dÃ©clipsant le plastique noir.
</li></ul>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Connecteur%20Cam.jpeg'></p>
<br>
<p>InsÃ©rez la nappe dÃ©licatement jusquâ€™au fond du connecteur. Attention, vÃ©rifiez bien que les connecteurs sont dans le bon sens (connecteurs cÃ´tÃ© prise mini-hdmi)</p>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Connecteur%20Cam2.jpeg'></p>
<br>
<p>Enfin, clipsez le plastique noir afin que la nappe du module camÃ©ra tienne bien dans le connecteur.</p>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Connecteur%20Cam3.jpeg'></p>
<br>
<ul><li>Il ne nous reste plus quâ€™Ã  brancher le cÃ¢ble USB C reliÃ© Ã  votre PC pour alimenter le Raspberry Pi.
</li></ul>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Cable%20Alim.jpeg'></p>
<br>
<p>Une diode rouge va sâ€™allumer, Ã§a signifie que votre Raspberry est sous tension.</p>
<p>La verte indique lâ€™activitÃ© de lecture / Ã©crire sur la carte mÃ©moire.</p>
<br>
<blockquote>
<p>ğŸ’¡ Le Raspberry Pi met 45 secondes pour dÃ©marrer son systÃ¨me. Prenez lâ€™habitude de lui laisser 1 minute, le temps quâ€™il puisse lancer tous ses services.</p>
</blockquote>
<br>
<br>
<hr>
<br>
<br>
<h1>II - Connexion & Configuration</h1>
<h2>II.1 - Prologue, configuration faite par @La_Briqueterie</h2>
<p>Pour le bon dÃ©roulÃ© de cet atelier et afin quâ€™il soit le plus intÃ©ressant possible pour vous (quâ€™il ne dure pas 48h), nous avons prÃ©configurÃ© vos Raspberry Pi en amont.</p>
<p>Nous allons donc vous exposer les grandes lignes afin que vous ayez tous les Ã©lÃ©ments en main pour refaire la configuration dans le futur si le coeur vous en dit.</p>
<br>
<h3>Lâ€™OS - Raspbian</h3>
<p>Avant toute chose, il faut commencer par installer un systÃ¨me dâ€™exploitation.</p>
<p>Plusieurs OS sont disponibles pour Raspberry Pi. Nous avons utilisÃ© le systÃ¨me officiel <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a> qui est un systÃ¨me d'exploitation libre basÃ© sur Debian et optimisÃ© pour fonctionner sur un Raspberry Pi.</p>
<br>
<h3>Session & mot de passe administrateur</h3>
<p>Chaque Raspberry a comme nom dâ€™utilisateur / session â€œpiâ€ et mot de passe â€œpasswordâ€ (on a trouvÃ© Ã§a mieux que 1234 ğŸ¤«).</p>
<p>Naturellement nous avons fait cette configuration totalement â€œno safetyâ€ afin de pouvoir interagir avec vous tous au long de la journÃ©e avec simplicitÃ© et optimiser nos longues heures de configurations. Nous vous encourageons vivement Ã  changer le mot de passe de session une fois lâ€™atelier fini.</p>
<br>
<h3>Wifi & IP fixe</h3>
<p>Nous avons mis en place une infrastructure rÃ©seau composÃ©e de deux routeurs distincts. Chaque Raspberry Pi Ã  Ã©tÃ© connectÃ© via Wifi Ã  lâ€™un des deux routeurs et nous leur avons attribuÃ© une adresse IP fixe (dâ€™oÃ¹ les magnifiques post it verts / jaune pour savoir ğŸ˜Œ)</p>
<p>Ce qui signifie quâ€™au moment oÃ¹ vous lisez ces lignes, votre Raspberry est dÃ©jÃ  connectÃ© au Wifi de La Briqueterie, prÃªt Ã  servir, et vous allez pouvoir interagir avec en utilisant son adresse IP (on y revient dans un instant).</p>
<br>
<h3>Librairie OpenCV</h3>
<p>Comme vous le savez dÃ©jÃ , vous allez dÃ©couvrir la librairie OpenCV afin de gÃ©rer la reconnaissance faciale.</p>
<p>TÃ©lÃ©chargement, compilation et configuration auraient nÃ©cessitÃ© environ deux heures. Nous vous Ã©pargnons donc ce processus plutÃ´t fastidieux pour nous concentrer sur les parties les plus intÃ©ressantes.</p>
<p>Pour les plus codeurs dâ€™entre vous, nâ€™hÃ©sitez pas Ã  nous solliciter si vous voulez que lâ€™on vous montre les diffÃ©rentes commandes effectuÃ©es ğŸ¤“</p>
<br>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Maintenant Ã  vous de jouer !</b></p>
<br>
<br>
<h2>II.2 - Wifi pour votre PC</h2>
<p>Il faut dÃ©sormais connecter votre PC au bon rÃ©seau Wifi afin de pouvoir accÃ©der Ã  votre Raspberry Pi. Le choix est simple, il dÃ©pend de la couleur de votre post it :</p>
<ol start="1"><li><b>VERT :</b> Wifi â€œNetgear19â€ & pass â€œcheerfulmint161â€
</li><li><b>JAUNE :</b> Wifi â€œNetgear56â€ & pass â€œcloudycoconut379â€
</li></ol>
<br>
<p><b><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> Afin de ne pas surcharger lâ€™infrastructure rÃ©seau et pour le bon dÃ©roulÃ© de lâ€™atelier, merci de ne pas connecter vos smartphones au Wifi ğŸ™ (pour lâ€™instant... ğŸ˜)</b></p>
<br>
<blockquote>
<p>ğŸ’¡ Si vous Ãªtes un habituÃ© de La Briqueterie, il se peut que soyez dÃ©jÃ  connectÃ© Ã  notre Wifi â€œLa Briqueâ€. Si câ€™est le cas, retirez ce rÃ©seau de votre liste afin dâ€™Ã©viter de potentielles erreurs ğŸ˜‰</p>
</blockquote>
<br>
<br>
<h2>II.3 - Connexion au Raspberry Pi en SSH</h2>
<p>SSH est un protocole de communication sÃ©curisÃ© qui va nous permettre de communiquer avec le Raspberry Pi sur le mÃªme rÃ©seau.</p>
<br>
<h3>Windows</h3>
<p>Il vous faudra au prÃ©alable tÃ©lÃ©charger et installer le client SSH <a href="https://www.putty.org">Putty</a></p>
<br>
<h3>macOS & Linux</h3>
<p>Utilisez la commande SSH pour vous connecter Ã  votre Raspberry via son adresse IP (pour rappel elle est notÃ©e sur le post it ğŸ˜‰) :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">ssh</span> pi@10.0.0.10</code></pre>
<p><br></p>
<p>Renseigner votre mot de passe, pour rappel câ€™est lâ€™original â€œpasswordâ€.</p>
<p>Vous devriez voir apparaitre ceci :</p>
<p><code class='code-inline'>pi@raspberrypi:~ $</code></p>
<br>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Vous voici connectÃ© ğŸ™Œ</b></p>
<br>
<br>
<h2>II.4 - Administration systÃ¨me de base</h2>
<h3>Faisons le mÃ©nage</h3>
<p>Avoir un systÃ¨me dâ€™exploitation avec plein de choses immÃ©diatement disponibles câ€™est intÃ©ressant. Mais Ã  lâ€™inverse Raspbian embarque par dÃ©faut quelques Ã©lÃ©ments qui ne nous serviront pas (comme Libre Office) et prennent de la place (prÃ©cieuse) sur notre carte mÃ©moireâ€¦ On va donc commencer par faire un brin de mÃ©nage.</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> purge wolfram-engine
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> purge libreoffice*
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> clean
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> autoremove</code></pre>
<p><br></p>
<h3>Installation des dÃ©pendances</h3>
<p>Nous allons dans cette partie installer plusieurs dÃ©pendances, des paquets (ou librairies) qui sont nÃ©cessaires au dÃ©veloppement de notre solution.</p>
<br>
<p>CommenÃ§ons par vÃ©rifier que tous les paquets dÃ©jÃ  installÃ©s sur la machine sont bien Ã  jour :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> update <span class="sf_code_operator">&&</span> <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> upgrade</code></pre>
<p><br></p>
<p>On installe un ensemble de paquets dits essentiels, qui vont nous servir pour la suite des manipulations :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> build-essential cmake pkg-config</code></pre>
<p><br></p>
<blockquote>
<p>ğŸ’¡ Vous aurez remarquÃ© quâ€™aucun paquet nâ€™a Ã©tÃ© mis Ã  jour, en rÃ©alitÃ© nous avons dÃ©jÃ  effectuÃ© cette commande par nÃ©cessitÃ© pour lâ€™installation dâ€™OpenCV. Cependant nous tenions Ã  vous la prÃ©senter dans ce tuto car elle vous sera utile pour la plupart de vos futurs projets sur Raspberry Pi.</p>
</blockquote>
<br>
<p>Passons aux librairies nÃ©cessaires au traitement des images :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev</code></pre>
<p><br></p>
<p>Et naturellement celles pour le traitement des vidÃ©os :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> libavcodec-dev libavformat-dev libswscale-dev libv4l-dev
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> libxvidcore-dev libx264-dev</code></pre>
<p><br></p>
<p>Si nous branchons le Raspberry Pi Ã  un Ã©cran, ce paquet permet dâ€™afficher le flux de la camÃ©ra connectÃ©e dans une fenÃªtre de lâ€™interface graphique de lâ€™OS.</p>
<p>Vous nâ€™en aurez pas besoin de suite. Ce paquet est optionnel, mais peut sâ€™avÃ©rer nÃ©cessaire, nous vous recommandons donc de lâ€™installer.</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> libgtk2.0-dev libgtk-3-dev</code></pre>
<p><br></p>
<p>Enfin, installons un ensemble dâ€™Ã©lÃ©ments (comme des calculs de matrices) qui seront utilisÃ©s par la librairie OpenCV afin dâ€™optimiser son traitement :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> libatlas-base-dev gfortran</code></pre>
<p><br></p>
<h3>Python</h3>
<p>Le Ã©tapes de dÃ©veloppement qui vont suivre se feront avec le langage Python, nous allons donc installer toutes les dÃ©pendances qui y sont liÃ©es.</p>
<p>La suite du tuto a Ã©tÃ© pensÃ©e sur la version 3 de Python. Cependant de nombreuses librairies utilisent encore la version 2.7 et certains dÃ©veloppeurs prÃ©fÃ¨rent travailler avec cette version de Python.</p>
<p>Nous installons donc les deux versions de Python, ainsi que <b>pip</b> qui est le gestionnaire de dÃ©pendances dÃ©diÃ© Ã  Python.</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">apt-get</span> <span class="sf_code_function">install</span> python2.7-dev python3-dev
$ <span class="sf_code_function">wget</span> https://bootstrap.pypa.io/get-pip.py
$ <span class="sf_code_function">sudo</span> python get-pip.py
$ <span class="sf_code_function">sudo</span> python3 get-pip.py</code></pre>
<p><br></p>
<h3>Environnement Virtuel</h3>
<p>Il va nous permettre de crÃ©er un environnement au sein duquel nous pourrons installer les dÃ©pendances de Python. Câ€™est une bonne pratique de crÃ©er un environnement par projet, Ã§a permet de crÃ©er une sorte de sandbox, les installations seront contenues dans cet environnement et nâ€™aurons pas dâ€™impact sur le systÃ¨me. En cas dâ€™incompatibilitÃ© ou dâ€™erreur technique, cela permet dâ€™isoler le problÃ¨me et de garder le systÃ¨me fonctionnel.</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">sudo</span> pip <span class="sf_code_function">install</span> virtualenv virtualenvwrapper
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">rm</span> -rf ~/.cache/pip</code></pre>
<p><br></p>
<p>Ã‰ditez le fichier <code class='code-inline'>~/.profile</code>  avec  <code class='code-inline'>nano</code> et ajouter au dÃ©but du fichier :</p>
<pre><code class='code-multiline' lang='bash'><span class="sf_code_comment"># virtualenv and virtualenvwrapper</span>
<span class="sf_code_function">export</span> WORKON_HOME<span class="sf_code_operator">=</span><span class="sf_code_variable">$HOME</span>/.virtualenvs
<span class="sf_code_function">export</span> VIRTUALENVWRAPPER_PYTHON<span class="sf_code_operator">=</span>/usr/bin/python3
<span class="sf_code_function">source</span> /usr/local/bin/virtualenvwrapper.sh</code></pre>
<p><br></p>
<p>Appliquez les modifications avec la commande <b>source</b> :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">source</span> ~/.profile</code></pre>
<p><br></p>
<p>Et enfin, crÃ©ons notre environnement virtuel â€œcvâ€, le tour est jouÃ© ğŸ‘Œ :</p>
<pre><code class='code-multiline' lang='bash'>$ mkvirtualenv cv -p python3
</code></pre><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> Vous verrez apparaitre <b>â€œ(cv)â€</b> au dÃ©but de votre prompt.

<u>Pour info</u>, pour sortir de lâ€™environnement vous pourrez utiliser :
<pre><code class='code-multiline' lang='bash'>$ deactivate</code></pre>
<p><br></p>
<p>Et pour y rentrer de nouveau :</p>
<pre><code class='code-multiline' lang='bash'>$ workon cv</code></pre>
<p><br></p>
<p><b>Une fois dans votre environnement</b>, installez la dÃ©pendance â€œnumpyâ€, qui permettra dâ€™exÃ©cuter des calculs scientifiques au sein dâ€™OpenCV :</p>
<pre><code class='code-multiline' lang='bash'>$ pip <span class="sf_code_function">install</span> numpy</code></pre>
<p><br></p>
<p>Comme mentionnÃ© prÃ©cÃ©demment, nous avons dÃ©jÃ  installÃ© la librairie OpenCV en amont. Il reste cependant une ultime Ã©tape importante Ã  votre chargeâ€¦ Maintenant que Python est installÃ© et configurÃ©, il nous faut le lier Ã  OpenCV ğŸ˜Œ :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">cd</span> ~/.virtualenvs/cv/lib/python3.7/site-packages/
$ <span class="sf_code_function">ln</span> -s /usr/local/python/cv2/python-3.7/cv2.cpython-37m-arm-linux-gnueabihf.so cv2.so
$ <span class="sf_code_function">cd</span> ~</code></pre>
<p><br></p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Thatâ€™s all folks ! ğŸ¤—</b></p>
<br>
<h3>Testons</h3>
<p>Avant dâ€™aller plus loin, assurons-nous que toute notre installation et configuration est bien fonctionnelle :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">source</span> ~/.profile
$ workon cv
$ python
<span class="sf_code_operator">&gt;&gt;&gt;</span> <span class="sf_code_function">import</span> cv2
<span class="sf_code_operator">&gt;&gt;&gt;</span> cv2.__version__
â€˜4.0.0â€™
<span class="sf_code_operator">&gt;&gt;&gt;</span></code></pre>
<p><br></p>
<p><b><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> Si vous ne rencontrez pas d'erreur et voyez â€œ4.0.0â€ c'est que vous avez super bien gÃ©rÃ© et on passe Ã  l'Ã©tape supÃ©rieure ! ğŸ˜</b></p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/we-did-it.jpg'></p>
<br>
<br>
<hr>
<br>
<h1>III - PrÃ©paration du stream vidÃ©o</h1>
<p>Et si on jetait un oeil Ã  ce que voit notre camÃ©ra ? ğŸ§</p>
<br>
<h2>III.1 - Capter le flux vidÃ©o</h2>
<p>Pour nous faciliter le travail, nous allons utiliser la librairie <b>mjpg-streamer</b> afin de capter le flux de la camÃ©ra et de lâ€™afficher dans une page web.</p>
<br>
<blockquote>
<p>ğŸ’¡ Pour rappel vÃ©rifier bien que vous Ãªtes dans votre environnement â€œcvâ€, si ce nâ€™est pas le cas utilisez la commande <code class='code-inline'>workon cv</code></p>
</blockquote>
<br>
<p>CommenÃ§ons par rÃ©cupÃ©rer les fichiers source de cette librairie et lanÃ§ons la compilation :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">cd</span> /tmp
$ <span class="sf_code_function">git</span> clone https://github.com/jacksonliam/mjpg-streamer.git
$ <span class="sf_code_function">cd</span> mjpg-streamer/mjpg-streamer-experimental
$ cmake -DPLUGIN_INPUT_OPENCV<span class="sf_code_operator">=</span>OFF
$ <span class="sf_code_function">make</span>
$ <span class="sf_code_function">sudo</span> <span class="sf_code_function">make</span> <span class="sf_code_function">install</span></code></pre>
<p><br></p>
<blockquote>
<p>ğŸ’¡ Le DPLUGIN est une Ã©tape importante, si vous lâ€™oubliez la compilation Ã©chouera. En effet, jpg-steamer intÃ¨gre une partie dâ€™OpenCV (une vieille version). Or, nous avons dÃ©jÃ  installÃ© et configurÃ© la librairie OpenCV, nous dÃ©sactivons donc cette partie du cÃ´tÃ© de jpg-steamer.</p>
</blockquote>
<br>
<p>On va maintenant dÃ©clencher lâ€™Ã©coute du flux de la camÃ©ra avec la commande <b>raspistill</b> et enregistrer une image toutes les 5 millisecondes :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">cd</span>
$ <span class="sf_code_function">mkdir</span> tmp
$ <span class="sf_code_function">cd</span> tmp
$ <span class="sf_code_function">mkdir</span> stream
$ raspistill -w 640 -h 480 -q 5 -o tmp/stream/pic.jpg -tl 500 -t 9999999</code></pre>
<p><br></p>
<blockquote>
<p>ğŸ’¡ Vous aurez remarquÃ© les paramÃ¨tres <i>-w 640 -h 480</i>, il sâ€™agit de la rÃ©solution de lâ€™image que nous avons volontairement dÃ©finie en basse rÃ©solution. Vous pourrez revenir par la suite jouer avec ces paramÃ¨tres pour faire varier la qualitÃ© en fonction des performances finales ğŸ‘¨â€ğŸ’»</p>
</blockquote>
<p>  </p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Vous voyez maintenant chaque frame qui est enregistrÃ© dans notre fichier .jpg ğŸ˜ Laissez tourner et passons Ã  la suiteâ€¦</b></p>
<br>
<p>Ouvrez un nouveau terminal et connectez-vous Ã  nouveau au Raspberry Pi avec SSH.</p>
<p>On met enfin en place un serveur <u>â€rtspâ€</u> (â€œReal Time Streaming Protocol), notre streaming, et câ€™est dans la boite :</p>
<pre><code class='code-multiline' lang='bash'>$ mjpg_streamer -i <span class="sf_code_string">"/usr/local/lib/mjpg-streamer/input_file.so -f tmp/stream -n pic.jpg -delay 0.1"</span> -o <span class="sf_code_string">"output_http.so -p 8080 -w /usr/local/share/mjpg-streamer/www"</span></code></pre>
<p><br></p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Ã‡a tourne, on laisse tranquille et on revient Ã  notre PC ğŸ˜Œ</b></p>
<br>
<h2>III.2 - Le flux dans une page Web</h2>
<p>Maintenant que la captation du flux vidÃ©o est fonctionnelle, on va lâ€™intÃ©grer au sein dâ€™une page HTML afin de pouvoir y accÃ©der depuis un navigateur, que ce soit sur desktop ou mobile.</p>
<br>
<blockquote>
<p>ğŸ‘€ Le dÃ©veloppement Web nâ€™Ã©tant pas le sujet majeur de cet atelier, nous ne nous attarderons pas trop sur cette partie. Nous vous fournissons ci-dessous une page de test basique qui nous a servi durant la conception de ce tuto. Elle a Ã©tÃ© crÃ©Ã©e par un gentil <i>Richard Atterer</i> qui nous fait gagner du temps â³</p>
</blockquote>
<br>
<p>On va donc crÃ©er un page HTML qui va simplement intÃ©grer le flux vidÃ©o avec un peu de code JavaScript.</p>
<p>RÃ©cupÃ©rez la page HTML sur votre machine (clic secondaire - â€œenregistrer sousâ€) et ouvrez-la avec votre Ã©diteur prÃ©fÃ©rÃ© :</p>
<p><a href='BRQTR%20-%20Tuto%20Coding%20Club%201/MaPage.html'>MaPage.html</a></p>
<br>
<p>Trouvez la ligne :</p>
<pre><code class='code-multiline' lang='html'>img.src = "http://10.0.0.10:8080/?action=snapshot&n=" + (++imageNr);</code></pre>
<p><br></p>
<p>Remplacez lâ€™adresse IP par celle de votre Raspberry Pi et sauvegardez.</p>
<br>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Il ne vous reste plus quâ€™Ã  ouvrir la page avec votre navigateur favoriâ€¦ TADAAAA ğŸ¤©</b></p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/c20f0cf8513d915a77bf06c35276c7e5.jpeg'></p>
<br>
<blockquote>
<p>ğŸ’¡ La saviez-vous ? Lancez simplement VLC et faites ouvrir un rÃ©seau. Renseignez lâ€™URL <code class='code-inline'>http://10.0.0.10:8080/?action=stream</code> en remplaÃ§ant avec lâ€™adresse IP de votre Raspberry Pi, it works ğŸ˜‰</p>
<p>Oui, Ã§a marche mÃªme sur mobile ğŸ¤«, mais on testera plus tard afin de ne pas tuer lâ€™infrastructure rÃ©seau ğŸ˜‡</p>
</blockquote>
<br>
<br>
<hr>
<br>
<br>
<h1>IV - Reconnaissance Faciale</h1>
<p>On rentre dans du lourdâ€¦ Du trÃ¨s trÃ¨s lourd !</p>
<p>Plus de bla-bla, vous savez pourquoi on est lÃ , câ€™est parti !!</p>
<br>
<h2>IV.1 - DÃ©tection de mouvement & objet</h2>
<p>Commencez par stopper la commande <code class='code-inline'>raspistill</code> en faisant <code class='code-inline'>ctrl+c</code>.</p>
<br>
<blockquote>
<p>âš ï¸ VÃ©rifiez que vous Ãªtes bien dans votre environnement â€œcvâ€</p>
</blockquote>
<br>
<p>On va rajouter quelques dÃ©pendances, des utilitaires pour le traitement dâ€™images avec OpenCV dont nous allons avoir besoin :</p>
<pre><code class='code-multiline' lang='bash'>$ pip <span class="sf_code_function">install</span> imutils
$ pip <span class="sf_code_function">install</span> picamera</code></pre>
<p><br></p>
<p>CrÃ©ez vous un dossier dans lequel travailler</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">mkdir</span> motioncapture
$ <span class="sf_code_function">cd</span> motioncapture</code></pre>
<p><br></p>
<p>CrÃ©ons un fichier de configuration <code class='code-inline'>conf.json</code> avec la commande <code class='code-inline'>nano</code></p>
<pre><code class='code-multiline' lang='json'><span class="sf_code_punctuation">{</span>
    <span class="sf_code_property">"show_img"</span><span class="sf_code_operator">:</span> <span class="sf_code_string">"../tmp/stream/pic.jpg"</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_property">"min_motion_frames"</span><span class="sf_code_operator">:</span> <span class="sf_code_number">8</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_property">"camera_warmup_time"</span><span class="sf_code_operator">:</span> <span class="sf_code_number">2.5</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_property">"delta_thresh"</span><span class="sf_code_operator">:</span> <span class="sf_code_number">5</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_property">"resolution"</span><span class="sf_code_operator">:</span> <span class="sf_code_punctuation">[</span><span class="sf_code_number">640</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">480</span><span class="sf_code_punctuation">],</span>
    <span class="sf_code_property">"fps"</span><span class="sf_code_operator">:</span> <span class="sf_code_number">60</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_property">"min_area"</span><span class="sf_code_operator">:</span> <span class="sf_code_number">5000</span>
<span class="sf_code_punctuation">}</span></code></pre>
<p><br></p>
<p>Ces paramÃ¨tres vont permettre de dÃ©finir :</p>
<ol start="1"><li>Le chemin oÃ¹ sera stockÃ©e lâ€™image qui sera diffusÃ©e dans le stream
</li><li>Combien dâ€™images sont nÃ©cessaires pour dÃ©terminer quâ€™il y a un objet en mouvement.
</li><li>Temps dâ€™initiation laissÃ© par le logiciel pour le dÃ©marrage de la camÃ©ra.
</li><li>Valeur du delta entre lâ€™image actuelle et la prÃ©cÃ©dente, selon sa valeur permet de mettre en Ã©vidence un objet en mouvement.
</li><li>La rÃ©solution vidÃ©o (pour le bon dÃ©roulÃ© de lâ€™atelier merci de ne pas tenter le diable en tentant direct la 4k et dâ€™attendre votre salon ğŸ™ Notre infra rÃ©seau vous en remercie ğŸ˜…)
</li><li>Nombre dâ€™images par seconde
</li><li>DÃ©termine la zone minimum pour tracer le rectangle qui matÃ©rialise visuellement lâ€™objet en mouvement (vous le verrez dans quelques instants ğŸ™ƒ)
</li></ol>
<br>
<h3>Le Code</h3>
<p>CrÃ©ez un fichier <code class='code-inline'>brqtr_motion_capture.py</code> avec <code class='code-inline'>nano</code>.</p>
<br>
<p>On va commencer par importer tous les Ã©lÃ©ments dont nous allons avoir besoin, une partie de ces dÃ©pendances ont Ã©tÃ© installÃ©es un peu plus tÃ´t par vous-mÃªme et les autres durant notre prÃ©paration Ã  lâ€™installation dâ€™OpenCV :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">from</span> picamera<span class="sf_code_punctuation">.</span>array <span class="sf_code_keyword">import</span> PiRGBArray
<span class="sf_code_keyword">from</span> picamera <span class="sf_code_keyword">import</span> PiCamera
<span class="sf_code_keyword">import</span> argparse
<span class="sf_code_keyword">import</span> warnings
<span class="sf_code_keyword">import</span> datetime
<span class="sf_code_keyword">import</span> imutils
<span class="sf_code_keyword">import</span> json
<span class="sf_code_keyword">import</span> time
<span class="sf_code_keyword">import</span> cv2</code></pre>
<p><br></p>
<p>DÃ©finition des arguments que la ligne de commande va prendre en paramÃ¨tre, en lâ€™occurrence ici, notre fichier de configuration prÃ©cÃ©demment crÃ©Ã© :</p>
<pre><code class='code-multiline' lang='python'>ap <span class="sf_code_operator">=</span> argparse<span class="sf_code_punctuation">.</span>ArgumentParser<span class="sf_code_punctuation">()</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-c"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--conf"</span><span class="sf_code_punctuation">,</span> required<span class="sf_code_operator">=</span><span class="sf_code_boolean">True</span><span class="sf_code_punctuation">,</span>
  <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"path to the JSON configuration file"</span><span class="sf_code_punctuation">)</span>
args <span class="sf_code_operator">=</span> <span class="sf_code_builtin">vars</span><span class="sf_code_punctuation">(</span>ap<span class="sf_code_punctuation">.</span>parse_args<span class="sf_code_punctuation">())</span>

warnings<span class="sf_code_punctuation">.</span>filterwarnings<span class="sf_code_punctuation">(</span><span class="sf_code_string">"ignore"</span><span class="sf_code_punctuation">)</span>
conf <span class="sf_code_operator">=</span> json<span class="sf_code_punctuation">.</span>load<span class="sf_code_punctuation">(</span><span class="sf_code_builtin">open</span><span class="sf_code_punctuation">(</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"conf"</span><span class="sf_code_punctuation">]))</span></code></pre>
<p><br></p>
<p>On configure notre camÃ©ra :</p>
<pre><code class='code-multiline' lang='python'>camera <span class="sf_code_operator">=</span> PiCamera<span class="sf_code_punctuation">()</span>
camera<span class="sf_code_punctuation">.</span>resolution <span class="sf_code_operator">=</span> <span class="sf_code_builtin">tuple</span><span class="sf_code_punctuation">(</span>conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"resolution"</span><span class="sf_code_punctuation">])</span>
camera<span class="sf_code_punctuation">.</span>framerate <span class="sf_code_operator">=</span> conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"fps"</span><span class="sf_code_punctuation">]</span>
rawCapture <span class="sf_code_operator">=</span> PiRGBArray<span class="sf_code_punctuation">(</span>camÃ©ra<span class="sf_code_punctuation">,</span> size<span class="sf_code_operator">=</span><span class="sf_code_builtin">tuple</span><span class="sf_code_punctuation">(</span>conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"resolution"</span><span class="sf_code_punctuation">]))</span>

<span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] warming upâ€¦"</span><span class="sf_code_punctuation">)</span>
time<span class="sf_code_punctuation">.</span>sleep<span class="sf_code_punctuation">(</span>conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"camera_warmup_time"</span><span class="sf_code_punctuation">])</span>
avg <span class="sf_code_operator">=</span> <span class="sf_code_boolean">None</span>
lastUploaded <span class="sf_code_operator">=</span> datetime<span class="sf_code_punctuation">.</span>datetime<span class="sf_code_punctuation">.</span>now<span class="sf_code_punctuation">()</span>
motionCounter <span class="sf_code_operator">=</span> <span class="sf_code_number">0</span></code></pre>
<p><br></p>
<p>Pour des raisons techniques (une boucle "for" par exemple) nous ne pouvons dÃ©couper le reste du code, vous trouverez les explications en commentaires directement dans le code pour chaque partie :</p>
<pre><code class='code-multiline' lang='python'>   <span class="sf_code_comment"># # # #</span>
   <span class="sf_code_comment"># DÃ©marrage de la capture</span>
   <span class="sf_code_comment">#</span>
<span class="sf_code_keyword">for</span> f <span class="sf_code_keyword">in</span> camera<span class="sf_code_punctuation">.</span>capture_continuous<span class="sf_code_punctuation">(</span>rawCapture<span class="sf_code_punctuation">,</span> <span class="sf_code_builtin">format</span><span class="sf_code_operator">=</span><span class="sf_code_string">"bgr"</span><span class="sf_code_punctuation">,</span> use_video_port<span class="sf_code_operator">=</span><span class="sf_code_boolean">True</span><span class="sf_code_punctuation">):</span>
    frame <span class="sf_code_operator">=</span> f<span class="sf_code_punctuation">.</span>array

   <span class="sf_code_comment"># # # #</span>
   <span class="sf_code_comment"># On rÃ©duit la taille dans le but dâ€™optimiser les temps 	 # de traitement et on applique des effets pour rÃ©duire 	 # le "bruit" de lâ€™image</span>
   <span class="sf_code_comment">#</span>
    frame <span class="sf_code_operator">=</span> imutils<span class="sf_code_punctuation">.</span>resize<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> width<span class="sf_code_operator">=</span><span class="sf_code_number">500</span><span class="sf_code_punctuation">)</span>
    gray <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>cvtColor<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> cv2<span class="sf_code_punctuation">.</span>COLOR_BGR2GRAY<span class="sf_code_punctuation">)</span>
    gray <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>GaussianBlur<span class="sf_code_punctuation">(</span>gray<span class="sf_code_punctuation">,</span> <span class="sf_code_punctuation">(</span><span class="sf_code_number">21</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">21</span><span class="sf_code_punctuation">),</span> <span class="sf_code_number">0</span><span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Check si image de rÃ©fÃ©rence existe ou pas</span>
    <span class="sf_code_comment">#</span>
    <span class="sf_code_keyword">if</span> avg <span class="sf_code_keyword">is</span> <span class="sf_code_boolean">None</span><span class="sf_code_punctuation">:</span>
        <span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] starting background modelâ€¦"</span><span class="sf_code_punctuation">)</span>
        avg <span class="sf_code_operator">=</span> gray<span class="sf_code_punctuation">.</span>copy<span class="sf_code_punctuation">().</span>astype<span class="sf_code_punctuation">(</span><span class="sf_code_string">"float"</span><span class="sf_code_punctuation">)</span>
        rawCapture<span class="sf_code_punctuation">.</span>truncate<span class="sf_code_punctuation">(</span><span class="sf_code_number">0</span><span class="sf_code_punctuation">)</span>
        <span class="sf_code_keyword">continue</span>

    <span class="sf_code_comment"># # # # #</span>
    <span class="sf_code_comment"># On isole la diffÃ©rence entre lâ€™image actuelle et la 	  # prÃ©cÃ©dente</span>
	  <span class="sf_code_comment">#</span>
    cv2<span class="sf_code_punctuation">.</span>accumulateWeighted<span class="sf_code_punctuation">(</span>gray<span class="sf_code_punctuation">,</span> avg<span class="sf_code_punctuation">,</span> <span class="sf_code_number">0.5</span><span class="sf_code_punctuation">)</span>
    frameDelta <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>absdiff<span class="sf_code_punctuation">(</span>gray<span class="sf_code_punctuation">,</span> cv2<span class="sf_code_punctuation">.</span>convertScaleAbs<span class="sf_code_punctuation">(</span>avg<span class="sf_code_punctuation">))</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># On applique un "threshold" sur le delta rÃ©cupÃ©rÃ©</span>
    <span class="sf_code_comment"># dans le but de faciliter la dÃ©tection du mouvement.</span>
    <span class="sf_code_comment"># Threshold =&gt; diffÃ©rence entre blanc / noir</span>
    <span class="sf_code_comment"># dilatation =&gt; augmente zone blanche</span>
    <span class="sf_code_comment">#</span>
    thresh <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>threshold<span class="sf_code_punctuation">(</span>frameDelta<span class="sf_code_punctuation">,</span> conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"delta_thresh"</span><span class="sf_code_punctuation">],</span> <span class="sf_code_number">255</span><span class="sf_code_punctuation">,</span>
        cv2<span class="sf_code_punctuation">.</span>THRESH_BINARY<span class="sf_code_punctuation">)[</span><span class="sf_code_number">1</span><span class="sf_code_punctuation">]</span>
    thresh <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>dilate<span class="sf_code_punctuation">(</span>thresh<span class="sf_code_punctuation">,</span> <span class="sf_code_boolean">None</span><span class="sf_code_punctuation">,</span> iterations<span class="sf_code_operator">=</span><span class="sf_code_number">2</span><span class="sf_code_punctuation">)</span>
    cnts <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>findContours<span class="sf_code_punctuation">(</span>thresh<span class="sf_code_punctuation">.</span>copy<span class="sf_code_punctuation">(),</span> cv2<span class="sf_code_punctuation">.</span>RETR_EXTERNAL<span class="sf_code_punctuation">,</span>
        cv2<span class="sf_code_punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="sf_code_punctuation">)</span>
    cnts <span class="sf_code_operator">=</span> imutils<span class="sf_code_punctuation">.</span>grab_contours<span class="sf_code_punctuation">(</span>cnts<span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># On dessine les contours de notre objet</span>
    <span class="sf_code_comment">#</span>
    <span class="sf_code_keyword">for</span> c <span class="sf_code_keyword">in</span> cnts<span class="sf_code_punctuation">:</span>
        <span class="sf_code_comment"># si le contour est trop petit par rapport a ce que nous avons dÃ©fini dans la configuration, on lâ€™ignore</span>
        <span class="sf_code_keyword">if</span> cv2<span class="sf_code_punctuation">.</span>contourArea<span class="sf_code_punctuation">(</span>c<span class="sf_code_punctuation">)</span> <span class="sf_code_operator">&lt;</span> conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"min_area"</span><span class="sf_code_punctuation">]:</span>
            <span class="sf_code_keyword">continue</span>

        <span class="sf_code_comment"># # # #</span>
        <span class="sf_code_comment"># Dessin du contour dans lâ€™image</span>
        <span class="sf_code_comment">#</span>
        <span class="sf_code_punctuation">(</span>x<span class="sf_code_punctuation">,</span> y<span class="sf_code_punctuation">,</span> w<span class="sf_code_punctuation">,</span> h<span class="sf_code_punctuation">)</span> <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>boundingRect<span class="sf_code_punctuation">(</span>c<span class="sf_code_punctuation">)</span>
        cv2<span class="sf_code_punctuation">.</span>rectangle<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> <span class="sf_code_punctuation">(</span>x<span class="sf_code_punctuation">,</span> y<span class="sf_code_punctuation">),</span> <span class="sf_code_punctuation">(</span>x <span class="sf_code_operator">+</span> w<span class="sf_code_punctuation">,</span> y <span class="sf_code_operator">+</span> h<span class="sf_code_punctuation">),</span> <span class="sf_code_punctuation">(</span><span class="sf_code_number">0</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">255</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">0</span><span class="sf_code_punctuation">),</span> <span class="sf_code_number">2</span><span class="sf_code_punctuation">)</span>
        
    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Sauvegarde de lâ€™image actuelle</span>
    <span class="sf_code_comment">#</span>
    <span class="sf_code_keyword">if</span> conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"show_img"</span><span class="sf_code_punctuation">]:</span>
        cv2<span class="sf_code_punctuation">.</span>imwrite<span class="sf_code_punctuation">(</span>conf<span class="sf_code_punctuation">[</span><span class="sf_code_string">"show_img"</span><span class="sf_code_punctuation">],</span> frame<span class="sf_code_punctuation">)</span> 
    
    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Nettoyage du stream pour la prochaine image</span>
    <span class="sf_code_comment">#</span>
    rawCapture<span class="sf_code_punctuation">.</span>truncate<span class="sf_code_punctuation">(</span><span class="sf_code_number">0</span><span class="sf_code_punctuation">)</span></code></pre>
<p><br></p>
<p>Maintenant exÃ©cutez votre script python :</p>
<pre><code class='code-multiline' lang='bash'>python brqtr_motion_capture.py --conf ./conf.json</code></pre>
<p><br></p>
<p>Enfin, ouvrez de nouveau votre page Webâ€¦ ğŸ˜°</p>
<br>
<p><b><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> Et voilÃ  ! ğŸ˜ƒ Votre Raspberry Pi est capable de dÃ©tecter des objets qui passent dans le champ de vision de la camÃ©ra.</b></p>
<br>
<blockquote>
<p>ğŸ’¡ Le motion tracking se fait par rapport au rÃ©fÃ©rentiel de la camÃ©ra, faites bien attention de la stabiliser comme il faut. Si vous la tenez et bougez / tremblez vous verrez apparaitre des carrÃ©s partout et ce sera tout Ã  fait normal ğŸ˜† Faites le test de la poser bien Ã  plat et passez votre bras par-dessus par exemple. Ou encore tenez la camÃ©ra et demandez Ã  un de vos camarades de passer devant en marchant ğŸ•º</p>
</blockquote>
<br>
<br>
<h2>IV.2 - Reconnaissance faciale</h2>
<p>Ultime grande Ã©tape, lâ€™aboutissement de ce Coding Dojoâ€¦ On va maintenant faire en sorte que notre Raspberry Pi soit capable de nous reconnaitre ainsi que notre voisin.</p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/71cd6b5bf0793da0165b1eeb37f900a9.jpg'></p>
<br>
<br>
<h3>Dataset - Nos photos</h3>
<p>CommenÃ§ons par crÃ©er lâ€™arborescence de notre projet, il est important que vous respectiez ces nomenclatures :</p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">cd</span> <span class="sf_code_punctuation">..</span>
$ <span class="sf_code_function">mkdir</span> facerecognition
$ <span class="sf_code_function">cd</span> facerecognition
$ <span class="sf_code_function">mkdir</span> dataset
$ <span class="sf_code_function">cd</span> dataset
$ <span class="sf_code_function">mkdir</span> prenom_nom </code></pre>
<p><br></p>
<p>Le dossier dataset va contenir des sous-dossiers correspondant Ã  chaque personne que nous souhaiterons identifier.</p>
<p>Nous allons maintenant ajouter des photos Ã  notre dossier qui serviront de base dâ€™apprentissage Ã  OpenCV. Plus vous en mettrez et plus la reconnaissance faciale sera efficace et prÃ©cise.</p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Nous nous limiterons Ã  4 pour cet atelier, mais sachez quâ€™idÃ©alement vous pouvez en mettre 20.</b></p>
<br>
<p><u>Avant dâ€™ajouter vos photos :</u></p>
<p>Il faut que vous rÃ©duisiez idÃ©alement la rÃ©solution Ã  <b>120x120</b> pixels et que la photo soit au format <b>.jpg</b>.</p>
<p>Câ€™est en effet une petite taille pour une photo de nos jours, mais rassurez-vous la puissance dâ€™OpenCV vous prouvera que ce nâ€™est pas un problÃ¨me. Et surtout cela rÃ©duira grandement les temps de calcul, on vous rappelle que notre valeureux Raspberry Pi embarque un petit processeur basse consommation et ne peut rivaliser avec un Xeon ğŸ™ƒ </p>
<br>
<ul><li>Une fois vos photos prÃªtes dans votre dossier <code class='code-inline'>prenom_nom</code>, faites-en un .zip
</li><li>Puis ouvrez un nouveau terminal sur votre PC
</li><li>Allez dans le dossier ou il y a vos photos formatÃ©es
</li><li>Lancez la commande <code class='code-inline'>$ scp prenom_nom.zip pi@IP:./</code>
</li></ul>
<br>
<blockquote>
<p>ğŸ’¡ <code class='code-inline'>scp</code> va vous permettre de sÃ©lectionner le fichier Ã  envoyer Ã  la racine de votre Raspberry Pi.</p>
</blockquote>
<br>
<p>Revenez maintenant Ã  votre terminal SSH contrÃ´lant votre Raspberry et effectuez les commandes suivantes : </p>
<pre><code class='code-multiline' lang='bash'>$ <span class="sf_code_function">mv</span> theo_papillon.zip facerecognition/dataset/
$ <span class="sf_code_function">cd</span> facerecognition/dataset/
$ unzip theo_papillon.zip</code></pre>
<p><br></p>
<p>VÃ©rifiez votre arborescence avec la commande <code class='code-inline'>tree</code>, vous devriez avoir un rendu comme ceci :</p>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/Screenshot%202020-01-24%20at%2017.43.31.png'></p>
<br>
<br>
<br>
<h3>Code</h3>
<br>
<p>Pour commencer, nous allons rajouter les toutes derniÃ¨res dÃ©pendances quâ€™il nous manque :</p>
<pre><code class='code-multiline' lang='bash'>$ pip <span class="sf_code_function">install</span> dlib
$ pip <span class="sf_code_function">install</span> face_recognition</code></pre>
<p><br></p>
<blockquote>
<p>ğŸ’¡ <code class='code-inline'>dlib</code> est une librairie qui nous fournit un modÃ¨le entrainÃ© avec 3 millions de tÃªtes pour OpenCV. Ce qui va nous permettre une grande optimisation et que OpenCV soit capable de nous reconnaitre avec seulement 4 photos au lieu de 20. </p>
</blockquote>
<br>
<p>Nous allons maintenant nous occuper du script Python permettant Ã  OpenCV dâ€™intÃ©grer nos photos, il gÃ©nÃ©rera un fichier <b>.pickle</b></p>
<br>
<p>Assurez-vous dâ€™Ãªtre au bon emplacement <code class='code-inline'>/home/pi/facerecognition</code></p>
<p>CrÃ©ez avec <code class='code-inline'>nano</code> le fichier <code class='code-inline'>encode_faces.py</code> </p>
<br>
<p>On commence comme toujours par importer les Ã©lÃ©ments dont nous avons besoin :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">from</span> imutils <span class="sf_code_keyword">import</span> paths
<span class="sf_code_keyword">import</span> face_recognition
<span class="sf_code_keyword">import</span> argparse
<span class="sf_code_keyword">import</span> pickle
<span class="sf_code_keyword">import</span> cv2
<span class="sf_code_keyword">import</span> os</code></pre>
<p><br></p>
<p>DÃ©finition des arguments que la ligne de commande va prendre en paramÃ¨tre :</p>
<pre><code class='code-multiline' lang='python'>ap <span class="sf_code_operator">=</span> argparse<span class="sf_code_punctuation">.</span>ArgumentParser<span class="sf_code_punctuation">()</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-i"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--dataset"</span><span class="sf_code_punctuation">,</span> required<span class="sf_code_operator">=</span><span class="sf_code_boolean">True</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"path to input directory of faces + images"</span><span class="sf_code_punctuation">)</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-e"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--encodings"</span><span class="sf_code_punctuation">,</span> required<span class="sf_code_operator">=</span><span class="sf_code_boolean">True</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"path to serialized db of facial encodings"</span><span class="sf_code_punctuation">)</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-d"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--detection-method"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_builtin">type</span><span class="sf_code_operator">=</span><span class="sf_code_builtin">str</span><span class="sf_code_punctuation">,</span> default<span class="sf_code_operator">=</span><span class="sf_code_string">"cnn"</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"face detection model to use: either `hog` or `cnn`"</span><span class="sf_code_punctuation">)</span>
args <span class="sf_code_operator">=</span> <span class="sf_code_builtin">vars</span><span class="sf_code_punctuation">(</span>ap<span class="sf_code_punctuation">.</span>parse_args<span class="sf_code_punctuation">())</span></code></pre>
<p><br></p>
<p>On rÃ©cupÃ¨re le chemin du dossier dataset qui contient toutes nos photos :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] quantifying facesâ€¦"</span><span class="sf_code_punctuation">)</span>
imagePaths <span class="sf_code_operator">=</span> <span class="sf_code_builtin">list</span><span class="sf_code_punctuation">(</span>paths<span class="sf_code_punctuation">.</span>list_images<span class="sf_code_punctuation">(</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"dataset"</span><span class="sf_code_punctuation">]))</span>

knownEncodings <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">[]</span>
knownNames <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">[]</span></code></pre>
<p><br></p>
<p>On dÃ©marre notre process pour chaque photo :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">for</span> <span class="sf_code_punctuation">(</span>i<span class="sf_code_punctuation">,</span> imagePath<span class="sf_code_punctuation">)</span> <span class="sf_code_keyword">in</span> <span class="sf_code_builtin">enumerate</span><span class="sf_code_punctuation">(</span>imagePaths<span class="sf_code_punctuation">):</span>
    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># On rÃ©cupÃ¨re le nom de lâ€™image</span>
    <span class="sf_code_comment"># </span>
    <span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] processing image {}/{}"</span><span class="sf_code_punctuation">.</span><span class="sf_code_builtin">format</span><span class="sf_code_punctuation">(</span>i <span class="sf_code_operator">+</span> <span class="sf_code_number">1</span><span class="sf_code_punctuation">,</span>
        <span class="sf_code_builtin">len</span><span class="sf_code_punctuation">(</span>imagePaths<span class="sf_code_punctuation">)))</span>
    name <span class="sf_code_operator">=</span> imagePath<span class="sf_code_punctuation">.</span>split<span class="sf_code_punctuation">(</span>os<span class="sf_code_punctuation">.</span>path<span class="sf_code_punctuation">.</span>sep<span class="sf_code_punctuation">)[</span><span class="sf_code_operator">-</span><span class="sf_code_number">2</span><span class="sf_code_punctuation">]</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Chargement de lâ€™image et conversion des couleurs en </span>
	  <span class="sf_code_comment"># RGB car OpenCV attend ce format la</span>
    <span class="sf_code_comment">#</span>
    image <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>imread<span class="sf_code_punctuation">(</span>imagePath<span class="sf_code_punctuation">)</span>
    rgb <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>cvtColor<span class="sf_code_punctuation">(</span>image<span class="sf_code_punctuation">,</span> cv2<span class="sf_code_punctuation">.</span>COLOR_BGR2RGB<span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># RÃ©cupÃ©ration des hitbox par OpenCV</span>
    <span class="sf_code_comment">#</span>
    boxes <span class="sf_code_operator">=</span> face_recognition<span class="sf_code_punctuation">.</span>face_locations<span class="sf_code_punctuation">(</span>rgb<span class="sf_code_punctuation">,</span>
        model<span class="sf_code_operator">=</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"detection_method"</span><span class="sf_code_punctuation">])</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Encodage des tÃªtes trouvÃ©es</span>
    <span class="sf_code_comment"># Cette Ã©tape peut Ãªtre longue selon le nombre de </span>
    <span class="sf_code_comment"># tÃªtes trouvÃ©es</span>
	  <span class="sf_code_comment">#</span>
    encodings <span class="sf_code_operator">=</span> face_recognition<span class="sf_code_punctuation">.</span>face_encodings<span class="sf_code_punctuation">(</span>rgb<span class="sf_code_punctuation">,</span> boxes<span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Pour chaque img encodÃ©e on associe lâ€™encodage + nom</span>
    <span class="sf_code_comment">#</span>
    <span class="sf_code_keyword">for</span> encoding <span class="sf_code_keyword">in</span> encodings<span class="sf_code_punctuation">:</span>
        <span class="sf_code_comment"># ajout de chaque duo encodage+nom a notre set de</span>
		  <span class="sf_code_comment"># noms connus</span>
        <span class="sf_code_comment">#</span>
        knownEncodings<span class="sf_code_punctuation">.</span>append<span class="sf_code_punctuation">(</span>encoding<span class="sf_code_punctuation">)</span>
        knownNames<span class="sf_code_punctuation">.</span>append<span class="sf_code_punctuation">(</span>name<span class="sf_code_punctuation">)</span></code></pre>
<p><br></p>
<p>Et pour finir il faut sauvegarder tous ces Ã©lÃ©ments dans le fichier .pickle :</p>
<pre><code class='code-multiline' lang='bash'>print<span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] serializing encodingsâ€¦"</span><span class="sf_code_punctuation">)</span>
data <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">{</span><span class="sf_code_string">"encodings"</span><span class="sf_code_keyword">:</span> knownEncodings, <span class="sf_code_string">"names"</span><span class="sf_code_keyword">:</span> knownNames<span class="sf_code_punctuation">}</span>
f <span class="sf_code_operator">=</span> open<span class="sf_code_punctuation">(</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"encodings"</span><span class="sf_code_punctuation">]</span>, <span class="sf_code_string">"wb"</span><span class="sf_code_punctuation">)</span>
f.write<span class="sf_code_punctuation">(</span>pickle.dumps<span class="sf_code_punctuation">(</span>data<span class="sf_code_punctuation">))</span>
f.close<span class="sf_code_punctuation">()</span></code></pre>
<p><br></p>
<p>ExÃ©cutez la commande :</p>
<pre><code class='code-multiline' lang='bash'>python encode_faces.py --dataset dataset --encodings encodings.pickle</code></pre>
<p><br></p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Patientez sagement le temps de lâ€™encodage ğŸ˜‡ Et on enchaine ğŸ˜ƒ</b></p>
<br>
<p>Ã€ prÃ©sent lâ€™ultime fichier qui finalisera notre solution ! ğŸ¥³</p>
<p>CrÃ©ez avec <code class='code-inline'>nano</code> le fichier <code class='code-inline'>brqtr_faces.py</code></p>
<br>
<p>On ne change pas une Ã©quipe qui gagne, nos import :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">from</span> imutils<span class="sf_code_punctuation">.</span>video <span class="sf_code_keyword">import</span> VideoStream
<span class="sf_code_keyword">import</span> face_recognition
<span class="sf_code_keyword">import</span> argparse
<span class="sf_code_keyword">import</span> imutils
<span class="sf_code_keyword">import</span> pickle
<span class="sf_code_keyword">import</span> time
<span class="sf_code_keyword">import</span> cv2</code></pre>
<p><br></p>
<p>DÃ©finition des arguments :</p>
<pre><code class='code-multiline' lang='python'>ap <span class="sf_code_operator">=</span> argparse<span class="sf_code_punctuation">.</span>ArgumentParser<span class="sf_code_punctuation">()</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-e"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--encodings"</span><span class="sf_code_punctuation">,</span> required<span class="sf_code_operator">=</span><span class="sf_code_boolean">True</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"path to serialized db of facial encodings"</span><span class="sf_code_punctuation">)</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-i"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--output-img"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_builtin">type</span><span class="sf_code_operator">=</span><span class="sf_code_builtin">str</span><span class="sf_code_punctuation">,</span>
  <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"path to output image"</span><span class="sf_code_punctuation">)</span>
ap<span class="sf_code_punctuation">.</span>add_argument<span class="sf_code_punctuation">(</span><span class="sf_code_string">"-d"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_string">"--detection-method"</span><span class="sf_code_punctuation">,</span> <span class="sf_code_builtin">type</span><span class="sf_code_operator">=</span><span class="sf_code_builtin">str</span><span class="sf_code_punctuation">,</span> default<span class="sf_code_operator">=</span><span class="sf_code_string">"hog"</span><span class="sf_code_punctuation">,</span>
    <span class="sf_code_builtin">help</span><span class="sf_code_operator">=</span><span class="sf_code_string">"face detection model to use: either `hog` or `cnn`"</span><span class="sf_code_punctuation">)</span>
args <span class="sf_code_operator">=</span> <span class="sf_code_builtin">vars</span><span class="sf_code_punctuation">(</span>ap<span class="sf_code_punctuation">.</span>parse_args<span class="sf_code_punctuation">())</span></code></pre>
<p><br></p>
<p>Initialisation :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_comment"># # # #</span>
<span class="sf_code_comment">#  Chargement des visages</span>
<span class="sf_code_comment">#</span>
<span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] loading encodingsâ€¦"</span><span class="sf_code_punctuation">)</span>
data <span class="sf_code_operator">=</span> pickle<span class="sf_code_punctuation">.</span>loads<span class="sf_code_punctuation">(</span><span class="sf_code_builtin">open</span><span class="sf_code_punctuation">(</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"encodings"</span><span class="sf_code_punctuation">],</span> <span class="sf_code_string">"rb"</span><span class="sf_code_punctuation">).</span>read<span class="sf_code_punctuation">())</span>

<span class="sf_code_comment"># # # #</span>
<span class="sf_code_comment"># Initialisation de la camÃ©ra</span>
<span class="sf_code_comment">#</span>
<span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] Intitialize the cameraâ€¦"</span><span class="sf_code_punctuation">)</span>
vs <span class="sf_code_operator">=</span> VideoStream<span class="sf_code_punctuation">(</span>usePiCamera<span class="sf_code_operator">=</span><span class="sf_code_number">1</span><span class="sf_code_punctuation">).</span>start<span class="sf_code_punctuation">()</span>

<span class="sf_code_comment"># # # #</span>
<span class="sf_code_comment"># Warmup de la camÃ©ra</span>
<span class="sf_code_comment">#</span>
<span class="sf_code_keyword">print</span><span class="sf_code_punctuation">(</span><span class="sf_code_string">"[INFO] Camera warmupâ€¦"</span><span class="sf_code_punctuation">)</span>
time<span class="sf_code_punctuation">.</span>sleep<span class="sf_code_punctuation">(</span><span class="sf_code_number">2.0</span><span class="sf_code_punctuation">)</span></code></pre>
<p><br></p>
<p>ExÃ©cution :</p>
<pre><code class='code-multiline' lang='python'><span class="sf_code_keyword">while</span> <span class="sf_code_boolean">True</span><span class="sf_code_punctuation">:</span>
    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Lecture image actuelle</span>
    <span class="sf_code_comment">#</span>
    frame <span class="sf_code_operator">=</span> vs<span class="sf_code_punctuation">.</span>read<span class="sf_code_punctuation">()</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Conversion couleurs BGR en RGB pour OpenCV.</span>
    <span class="sf_code_comment"># Redimensionnement de la largeur de lâ€™image</span>
    <span class="sf_code_comment"># pour optimiser les temps de traitements</span>
	  <span class="sf_code_comment">#</span>
    rgb <span class="sf_code_operator">=</span> cv2<span class="sf_code_punctuation">.</span>cvtColor<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> cv2<span class="sf_code_punctuation">.</span>COLOR_BGR2RGB<span class="sf_code_punctuation">)</span>
    rgb <span class="sf_code_operator">=</span> imutils<span class="sf_code_punctuation">.</span>resize<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> width<span class="sf_code_operator">=</span><span class="sf_code_number">250</span><span class="sf_code_punctuation">)</span>
    r <span class="sf_code_operator">=</span> frame<span class="sf_code_punctuation">.</span>shape<span class="sf_code_punctuation">[</span><span class="sf_code_number">1</span><span class="sf_code_punctuation">]</span> <span class="sf_code_operator">/</span> <span class="sf_code_builtin">float</span><span class="sf_code_punctuation">(</span>rgb<span class="sf_code_punctuation">.</span>shape<span class="sf_code_punctuation">[</span><span class="sf_code_number">1</span><span class="sf_code_punctuation">])</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># RÃ©cupÃ©ration de la hitbox pour chaque visage</span>
    <span class="sf_code_comment">#</span>
    boxes <span class="sf_code_operator">=</span> face_recognition<span class="sf_code_punctuation">.</span>face_locations<span class="sf_code_punctuation">(</span>rgb<span class="sf_code_punctuation">,</span> model<span class="sf_code_operator">=</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"detection_method"</span><span class="sf_code_punctuation">])</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Encodage des visages trouvÃ©s</span>
    <span class="sf_code_comment"># Cette Ã©tape peut Ãªtre longue selon le nombre de </span>
    <span class="sf_code_comment"># visages trouvÃ©s</span>
	  <span class="sf_code_comment">#</span>
    encodings <span class="sf_code_operator">=</span> face_recognition<span class="sf_code_punctuation">.</span>face_encodings<span class="sf_code_punctuation">(</span>rgb<span class="sf_code_punctuation">,</span> boxes<span class="sf_code_punctuation">)</span>


     <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Pour chaque img encodÃ©e on associe lâ€™encodage + nom</span>
    <span class="sf_code_comment">#</span>
    names <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">[]</span>
    <span class="sf_code_keyword">for</span> encoding <span class="sf_code_keyword">in</span> encodings<span class="sf_code_punctuation">:</span>
        <span class="sf_code_comment"># # # #</span>
        <span class="sf_code_comment"># Comparaison du visage encodÃ© actuel avec le</span>
		  <span class="sf_code_comment"># dataset</span>
        <span class="sf_code_comment">#</span>
        matches <span class="sf_code_operator">=</span> face_recognition<span class="sf_code_punctuation">.</span>compare_faces<span class="sf_code_punctuation">(</span>data<span class="sf_code_punctuation">[</span><span class="sf_code_string">"encodings"</span><span class="sf_code_punctuation">],</span>
            encoding<span class="sf_code_punctuation">)</span>
        name <span class="sf_code_operator">=</span> <span class="sf_code_string">"Unknown"</span>

        <span class="sf_code_comment"># # # #</span>
        <span class="sf_code_comment"># Si Ã§a match, câ€™est quâ€™il y a une comparaison 			  # trouvÃ©e</span>
        <span class="sf_code_comment">#</span>
        <span class="sf_code_keyword">if</span> <span class="sf_code_boolean">True</span> <span class="sf_code_keyword">in</span> matches<span class="sf_code_punctuation">:</span>
    
            <span class="sf_code_comment"># On rÃ©cupÃ¨re tous les Ã©lÃ©ments correspondants 			   # au match</span>
            matchedIdxs <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">[</span>I <span class="sf_code_keyword">for</span> <span class="sf_code_punctuation">(</span>I<span class="sf_code_punctuation">,</span> b<span class="sf_code_punctuation">)</span> <span class="sf_code_keyword">in</span> <span class="sf_code_builtin">enumerate</span><span class="sf_code_punctuation">(</span>matches<span class="sf_code_punctuation">)</span> <span class="sf_code_keyword">if</span> b<span class="sf_code_punctuation">]</span>
            counts <span class="sf_code_operator">=</span> <span class="sf_code_punctuation">{}</span>

            <span class="sf_code_comment"># Pour chaque match, rÃ©cupÃ©ration nom + 					   # incrÃ©mentation "probabilitÃ©"</span>
            <span class="sf_code_keyword">for</span> I <span class="sf_code_keyword">in</span> matchedIdxs<span class="sf_code_punctuation">:</span>
                name <span class="sf_code_operator">=</span> data<span class="sf_code_punctuation">[</span><span class="sf_code_string">"names"</span><span class="sf_code_punctuation">][</span>I<span class="sf_code_punctuation">]</span>
                counts<span class="sf_code_punctuation">[</span>name<span class="sf_code_punctuation">]</span> <span class="sf_code_operator">=</span> counts<span class="sf_code_punctuation">.</span>get<span class="sf_code_punctuation">(</span>name<span class="sf_code_punctuation">,</span> <span class="sf_code_number">0</span><span class="sf_code_punctuation">)</span> <span class="sf_code_operator">+</span> <span class="sf_code_number">1</span>

            <span class="sf_code_comment"># ContrÃ´le et rÃ©cupÃ©ration du nom </span>
            name <span class="sf_code_operator">=</span> <span class="sf_code_builtin">max</span><span class="sf_code_punctuation">(</span>counts<span class="sf_code_punctuation">,</span> key<span class="sf_code_operator">=</span>counts<span class="sf_code_punctuation">.</span>get<span class="sf_code_punctuation">)</span>
        
        <span class="sf_code_comment"># Sauvegarde</span>
        names<span class="sf_code_punctuation">.</span>append<span class="sf_code_punctuation">(</span>name<span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># # # #</span>
    <span class="sf_code_comment"># Dessin des cadres autour des tÃªtes dÃ©tectÃ©es </span>
    <span class="sf_code_comment">#</span>
    <span class="sf_code_keyword">for</span> <span class="sf_code_punctuation">((</span>top<span class="sf_code_punctuation">,</span> right<span class="sf_code_punctuation">,</span> bottom<span class="sf_code_punctuation">,</span> left<span class="sf_code_punctuation">),</span> name<span class="sf_code_punctuation">)</span> <span class="sf_code_keyword">in</span> <span class="sf_code_builtin">zip</span><span class="sf_code_punctuation">(</span>boxes<span class="sf_code_punctuation">,</span> names<span class="sf_code_punctuation">):</span>
        <span class="sf_code_comment"># redimensionnement</span>
        top <span class="sf_code_operator">=</span> <span class="sf_code_builtin">int</span><span class="sf_code_punctuation">(</span>top <span class="sf_code_operator">*</span> r<span class="sf_code_punctuation">)</span>
        right <span class="sf_code_operator">=</span> <span class="sf_code_builtin">int</span><span class="sf_code_punctuation">(</span>right <span class="sf_code_operator">*</span> r<span class="sf_code_punctuation">)</span>
        bottom <span class="sf_code_operator">=</span> <span class="sf_code_builtin">int</span><span class="sf_code_punctuation">(</span>bottom <span class="sf_code_operator">*</span> r<span class="sf_code_punctuation">)</span>
        left <span class="sf_code_operator">=</span> <span class="sf_code_builtin">int</span><span class="sf_code_punctuation">(</span>left <span class="sf_code_operator">*</span> r<span class="sf_code_punctuation">)</span>

        <span class="sf_code_comment"># dessin du rectangle et du nom</span>
        cv2<span class="sf_code_punctuation">.</span>rectangle<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> <span class="sf_code_punctuation">(</span>left<span class="sf_code_punctuation">,</span> top<span class="sf_code_punctuation">),</span> <span class="sf_code_punctuation">(</span>right<span class="sf_code_punctuation">,</span> bottom<span class="sf_code_punctuation">),</span>
            <span class="sf_code_punctuation">(</span><span class="sf_code_number">0</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">255</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">0</span><span class="sf_code_punctuation">),</span> <span class="sf_code_number">2</span><span class="sf_code_punctuation">)</span>
        y <span class="sf_code_operator">=</span> top <span class="sf_code_operator">-</span> <span class="sf_code_number">15</span> <span class="sf_code_keyword">if</span> top <span class="sf_code_operator">-</span> <span class="sf_code_number">15</span> <span class="sf_code_operator">&gt;</span> <span class="sf_code_number">15</span> <span class="sf_code_keyword">else</span> top <span class="sf_code_operator">+</span> <span class="sf_code_number">15</span>
        cv2<span class="sf_code_punctuation">.</span>putText<span class="sf_code_punctuation">(</span>frame<span class="sf_code_punctuation">,</span> name<span class="sf_code_punctuation">,</span> <span class="sf_code_punctuation">(</span>left<span class="sf_code_punctuation">,</span> y<span class="sf_code_punctuation">),</span> cv2<span class="sf_code_punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="sf_code_punctuation">,</span>
            <span class="sf_code_number">0.75</span><span class="sf_code_punctuation">,</span> <span class="sf_code_punctuation">(</span><span class="sf_code_number">0</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">255</span><span class="sf_code_punctuation">,</span> <span class="sf_code_number">0</span><span class="sf_code_punctuation">),</span> <span class="sf_code_number">2</span><span class="sf_code_punctuation">)</span>

    <span class="sf_code_comment"># Sauvegarde en tant quâ€™image </span>
    <span class="sf_code_keyword">if</span> args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"output_img"</span><span class="sf_code_punctuation">]</span> <span class="sf_code_keyword">is</span> <span class="sf_code_operator">not</span> <span class="sf_code_boolean">None</span><span class="sf_code_punctuation">:</span>
        cv2<span class="sf_code_punctuation">.</span>imwrite<span class="sf_code_punctuation">(</span>args<span class="sf_code_punctuation">[</span><span class="sf_code_string">"output_img"</span><span class="sf_code_punctuation">],</span> frame<span class="sf_code_punctuation">)</span> </code></pre>
<p><br></p>
<p>Il ne nous reste plus quâ€™Ã  nettoyer :</p>
<pre><code class='code-multiline' lang='python'>cv2<span class="sf_code_punctuation">.</span>destroyAllWindows<span class="sf_code_punctuation">()</span>
vs<span class="sf_code_punctuation">.</span>stop<span class="sf_code_punctuation">()</span></code></pre>
<p><br></p>
<p>Et maintenant, lancez notre ultime script Python ğŸ¤</p>
<pre><code class='code-multiline' lang='bash'>$ python brqtr_faces.py --encodings encodings.pickle --output-img <span class="sf_code_punctuation">..</span>/tmp/stream/pic.jpg</code></pre>
<p><br></p>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> <b>Positionnez-vous devant votre camÃ©ra et admirez le rÃ©sultat !</b> ğŸ¥³</p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/image.gif'></p>
<br>
<br>
<hr>
<br>
<br>
<h1>V - Pour aller plus loin</h1>
<p>FÃ©licitations, vous Ãªtes arrivÃ© au bout de ce tuto !</p>
<p>Mais certainement pas de toutes les possibilitÃ©s que vous offre votre Raspberry Pi ğŸ¤©</p>
<br>
<p><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> Bon OK, vous pouvez connecter votre smartphone au Wifi et tester le flux vidÃ©o avec VLC, mais dÃ©connectez votre PC pour que le rÃ©seau tienne ğŸ˜…</p>
<br>
<p>Nous avons construit ce tuto dans le but dâ€™Ãªtre le plus accessible possible et de vous faire toucher un maximum de choses en quelques heures tout en atteignant lâ€™objectif final.</p>
<p>Il y a de nombreuses pistes possibles pour faire Ã©voluer votre solution, nous nous ferons un plaisir dâ€™en discuter avec vous, sollicitez-nous ! ğŸ˜ƒ</p>
<br>
<p>NÃ©anmoins voici une liste non exhaustive dâ€™idÃ©esâ€¦ On dit juste Ã§a comme Ã§a ğŸ˜‰</p>
<ul><li>vous amuser Ã  modifier les paramÃ¨tres afin de trouver les rÃ©glages qui vous correspondent le mieux pour trouver le meilleur compromis entre qualitÃ© / fluiditÃ© de la vidÃ©o
</li><li>basculer votre page HTML sur un serveur (ou le Raspberry Pi temporairement) afin de pouvoir accÃ©der Ã  cette page et au flux de la camÃ©ra depuis nâ€™importe quel device
</li><li>rajouter une fonction de play/plause au clic 
</li><li>vous faire un belle page HTML 
</li><li>rajouter une fonction dâ€™enregistrement via un bouton ou/et Ã  la dÃ©tection dâ€™un mouvement ou dâ€™une personne inconnue
<ul><li>	dans cette optique, faire en sorte que lâ€™enregistrement soit directement  upload sur un drive
</li><li>	envois dâ€™un SMS/Mail automatique lors de la dÃ©tection dâ€™un objet ou dâ€™une personne connue / inconnue
</li></ul></li><li>lecture dâ€™un son lors de la dÃ©tection dâ€™une personne (la reine des neiges quand un des enfants rentre par exemple ğŸ¥¶) 
</li></ul>
<br>
<p><b><span class='arrow'><svg width="11px" height="10px" viewBox="0 0 11 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >    <g id="right-arrow" >        <path d="M1.77635684e-14,5 L9,5" id="rod" stroke="#000000" stroke-width="2" ></path>        <path d="M11,5 L6,0.5 L6,9.5 L11,5 Z" id="point" fill="#000000"></path>    </g></svg></span> ETC ETC ETCâ€¦â€¦â€¦</b></p>
<br>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/CV5UzgHW4AAx6xC.jpg'></p>
<br>
<br>
<br>
<hr>
<br>
<br>
<h1>VI - Chez Vous</h1>
<p>Quelques conseils une fois que vous serez rentrÃ© Ã  la maison avec votre nouveau Raspberry Pi :</p>
<ol start="1"><li>Branchez-le Ã  un Ã©cran ou via Ethernet pour pouvoir refaire la configuration rÃ©seau et le connecter Ã  votre Wifi.
</li><li>Changez le mot de passe de session, il est temps de mettre quelque chose de plus sÃ©curisÃ© ğŸ˜
</li><li>Attribuez-lui une adresse IP fixe dans votre routeur / box internet comme nous lâ€™avions fait au prÃ©alable pour cet atelier. Cela vous permettra de toujours connaitre son adresse, elle ne changera pas, et vous pourrez vous y connecter en SSH / accÃ©der au flux de la camÃ©ra toujours de la mÃªme maniÃ¨re.
</li><li>Mettez la page Web sur le Raspberry Pi ou un NAS / serveur afin de pouvoir y accÃ©der depuis nâ€™importe oÃ¹. Redirigez ensuite un des ports de votre box sur lâ€™adresse IP du Rasp. Depuis lâ€™extÃ©rieur accÃ©dez Ã  votre flux camera en utilisant lâ€™adresse IP de votre box internet.
</li><li>Nâ€™hÃ©sitez Ã  nous solliciter ğŸ˜‰
</li></ol>
<br>
<br>
<hr>
<br>
<h1>VII - On se voit au CD2 ? ğŸ˜‡</h1>
<p><img src='BRQTR%20-%20Tuto%20Coding%20Club%201/ob_d7a006_to-be-continued.jpg'></p>
<br>
<br>

        </div>
        <script type="text/javascript">
            (function() {

    var doc_ols = document.getElementsByTagName("ol");

    for ( i=0; i<doc_ols.length; i++) {

        var ol_start = doc_ols[i].getAttribute("start") - 1;
        doc_ols[i].setAttribute("style", "counter-reset:ol_counter " + ol_start + ";");

    }

})();

        </script>
        <style>
            html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline}html{line-height:1}ol,ul{list-style:none}table{border-collapse:collapse;border-spacing:0}caption,th,td{text-align:left;font-weight:normal;vertical-align:middle}q,blockquote{quotes:none}q:before,q:after,blockquote:before,blockquote:after{content:"";content:none}a img{border:none}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}*{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:87.5%;line-height:1.57143em}html{font-size:14px;line-height:1.6em;-webkit-text-size-adjust:100%}body{background:#fcfcfc;color:#545454;text-rendering:optimizeLegibility;font-family:"AvenirNext-Regular"}a{color:#de4c4f;text-decoration:none}h1{font-family:"AvenirNext-Medium";color:#333;font-size:1.6em;line-height:1.3em;margin-bottom:.78571em}h2{font-family:"AvenirNext-Medium";color:#333;font-size:1.3em;line-height:1em;margin-bottom:.62857em}h3{font-family:"AvenirNext-Medium";color:#333;font-size:1.15em;line-height:1em;margin-bottom:.47143em}p{margin-bottom:1.57143em;hyphens:auto}hr{height:1px;border:0;background-color:#dedede;margin:-1px auto 1.57143em auto}ul,ol{margin-bottom:.31429em}ul ul,ul ol,ol ul,ol ol{margin-bottom:0px}ol{counter-reset:ol_counter}ol li:before{content:counter(ol_counter) ".";counter-increment:ol_counter;color:#e06e73;text-align:right;display:inline-block;min-width:1em;margin-right:0.5em}b,strong{font-family:"AvenirNext-Bold"}i,em{font-family:"AvenirNext-Italic"}code{font-family:"Menlo-Regular"}.text-overflow-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.sf_code_string,.sf_code_selector,.sf_code_attr-name,.sf_code_char,.sf_code_builtin,.sf_code_inserted{color:#D33905}.sf_code_comment,.sf_code_prolog,.sf_code_doctype,.sf_code_cdata{color:#838383}.sf_code_number,.sf_code_boolean{color:#0E73A2}.sf_code_keyword,.sf_code_atrule,.sf_code_rule,.sf_code_attr-value,.sf_code_function,.sf_code_class-name,.sf_code_class,.sf_code_regex,.sf_code_important,.sf_code_variable,.sf_code_interpolation{color:#0E73A2}.sf_code_property,.sf_code_tag,.sf_code_constant,.sf_code_symbol,.sf_code_deleted{color:#1B00CE}.sf_code_macro,.sf_code_entity,.sf_code_operator,.sf_code_url{color:#920448}.note-wrapper{max-width:46em;margin:0px auto;padding:1.57143em 3.14286em}.note-wrapper.spotlight-preview{overflow-x:hidden}u{text-decoration:none;background-image:linear-gradient(to bottom, rgba(0,0,0,0) 50%,#e06e73 50%);background-repeat:repeat-x;background-size:2px 2px;background-position:0 1.05em}s{color:#878787}p{margin-bottom:0.1em}hr{margin-bottom:0.7em;margin-top:0.7em}ul li{text-indent:-0.35em}ul li:before{content:"â€¢";color:#e06e73;display:inline-block;margin-right:0.3em}ul ul{margin-left:1.25714em}ol li{text-indent:-1.45em}ol ol{margin-left:1.25714em}blockquote{display:block;margin-left:-1em;padding-left:0.8em;border-left:0.2em solid #e06e73}.todo-list ul{margin-left:1.88571em}.todo-list li{text-indent:-1.75em}.todo-list li:before{content:"";display:static;margin-right:0px}.todo-checkbox{text-indent:-1.7em}.todo-checkbox svg{margin-right:0.3em;position:relative;top:0.2em}.todo-checkbox svg #check{display:none}.todo-checkbox.todo-checked #check{display:inline}.todo-checkbox.todo-checked+.todo-text{text-decoration:line-through;color:#878787}.code-inline{display:inline;background:white;border:solid 1px #dedede;padding:0.2em 0.5em;font-size:0.9em}.code-multiline{display:block;background:white;border:solid 1px #dedede;padding:0.7em 1em;font-size:0.9em;overflow-x:auto}.hashtag{display:inline-block;color:white;background:#b8bfc2;padding:0.0em 0.5em;border-radius:1em;text-indent:0}.hashtag a{color:#fff}.address a{color:#545454;background-image:linear-gradient(to bottom, rgba(0,0,0,0) 50%,#0da35e 50%);background-repeat:repeat-x;background-size:2px 2px;background-position:0 1.05em}.address svg{position:relative;top:0.2em;display:inline-block;margin-right:0.2em}.color-preview{display:inline-block;width:1em;height:1em;border:solid 1px rgba(0,0,0,0.3);border-radius:50%;margin-right:0.1em;position:relative;top:0.2em;white-space:nowrap}.color-code{margin-right:0.2em;font-family:"Menlo-Regular";font-size:0.9em}.color-hash{opacity:0.4}.ordered-list-number{color:#e06e73;text-align:right;display:inline-block;min-width:1em}.arrow svg{position:relative;top:0.08em;display:inline-block;margin-right:0.15em;margin-left:0.15em}.arrow svg #rod{stroke:#545454}.arrow svg #point{fill:#545454}mark{color:inherit;display:inline;padding:0.2em 0.5em;background-color:#fcffc0}img{max-width:100%;height:auto}

        </style>
    </body>
</html>
